<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Crypto Vault</title>
<!-- EmailJS CDN (latest) -->
<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
  (function(){
    emailjs.init("T_-SjRTHAsYr0PkpI"); // Your EmailJS Public Key
  })();
</script>
<style>
body { font-family: system-ui, sans-serif; background: #f5f6fa; }
.container { max-width: 400px; margin: 60px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px #0001; padding: 32px; }
.hidden { display: none; }
input, button { width: 100%; margin: 8px 0; padding: 10px; border-radius: 6px; border: 1px solid #ccc; }
button { background: #2196f3; color: #fff; border: none; font-weight: bold; cursor: pointer; }
button:disabled { background: #90caf9; }
.msg { margin: 10px 0; color: #2196f3; }
.error { color: #f44336; }
.vault-container { display: none; }
</style>
</head>
<body>
<div class="container" id="otpLogin">
  <h2>Login to Crypto Vault</h2>
  <div id="step1">
    <input type="email" id="userEmail" placeholder="Enter your email" required />
    <button onclick="sendLoginCode()" id="sendBtn">Send Login Code</button>
    <div id="msg1" class="msg"></div>
  </div>
  <div id="step2" class="hidden">
    <input type="text" id="codeInput" placeholder="Enter code from email" maxlength="6" />
    <button onclick="verifyCode()">Login</button>
    <div id="msg2" class="msg"></div>
  </div>
</div>
<div class="vault-container">
<!-- ... (rest of your vault HTML unchanged) ... -->
</div>
<script>
const SERVICE_ID = "service_sddi48j"; // <-- Your real EmailJS Service ID
const TEMPLATE_ID = "template_nrvnos9";

function sendLoginCode() {
  const email = document.getElementById('userEmail').value.trim();
  const msg1 = document.getElementById('msg1');
  if (!email) {
    msg1.textContent = "Please enter your email.";
    msg1.className = "msg error";
    return;
  }
  const code = Math.floor(100000 + Math.random() * 900000);
  const now = new Date();
  const expire = new Date(now.getTime() + 15*60000);
  const expireStr = expire.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
  localStorage.setItem('loginCode', code);
  localStorage.setItem('loginCodeExpire', expire.getTime());

  document.getElementById('sendBtn').disabled = true;
  msg1.textContent = "Sending code...";
  msg1.className = "msg";
  emailjs.send(SERVICE_ID, TEMPLATE_ID, {
    to_email: email,      // <-- use to_email if that's your template variable
    passcode: code,
    time: expireStr
  }).then(function(response) {
    msg1.textContent = "Code sent! Check your email.";
    msg1.className = "msg";
    document.getElementById('step1').classList.add('hidden');
    document.getElementById('step2').classList.remove('hidden');
  }, function(error) {
    msg1.textContent = "Failed to send email. Try again.";
    msg1.className = "msg error";
    document.getElementById('sendBtn').disabled = false;
  });
}

function verifyCode() {
  const input = document.getElementById('codeInput').value.trim();
  const code = localStorage.getItem('loginCode');
  const expire = parseInt(localStorage.getItem('loginCodeExpire'), 10);
  const msg2 = document.getElementById('msg2');
  if (!input) {
    msg2.textContent = "Please enter the code.";
    msg2.className = "msg error";
    return;
  }
  if (Date.now() > expire) {
    msg2.textContent = "Code expired. Please request a new one.";
    msg2.className = "msg error";
    document.getElementById('step2').classList.add('hidden');
    document.getElementById('step1').classList.remove('hidden');
    document.getElementById('sendBtn').disabled = false;
    return;
  }
  if (input === code) {
    msg2.textContent = "Login successful!";
    msg2.className = "msg";
    document.getElementById('otpLogin').classList.add('hidden');
    document.querySelector('.vault-container').style.display = "block";
    localStorage.removeItem('loginCode');
    localStorage.removeItem('loginCodeExpire');
  } else {
    msg2.textContent = "Incorrect code.";
    msg2.className = "msg error";
  }
}

// ... (rest of your vault JS unchanged) ...
</script>
</body>
</html>