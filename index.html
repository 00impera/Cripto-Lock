<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Crypto Vault - Advanced Security</title>
<!-- EmailJS CDN -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  (function(){
    emailjs.init("T_-SjRTHAsYr0PkpI");
  })();
</script>
<!-- thirdweb SDK CDN -->
<script src="https://unpkg.com/thirdweb@latest/dist/thirdweb.umd.js"></script>
<!-- Inter font for modern look -->
<link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
  background: #18181b;
  min-height: 100vh;
  margin: 0;
  padding: 0;
}
#crypto-locker {
  background: rgba(255,255,255,0.07);
  border: 1.5px solid #e5e5e5;
  box-shadow: 0 8px 32px 0 rgba(130,71,229,0.08);
  border-radius: 18px;
  padding: 32px;
  margin: 40px auto;
  max-width: 520px;
  color: #222;
  font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
  position: relative;
  z-index: 2;
}
button {
  width: 100%;
  margin: 14px 0;
  padding: 14px 0;
  background: linear-gradient(90deg, #8247e5 0%, #ff8c00 100%);
  color: #fff;
  border: none;
  font-weight: 600;
  font-size: 16px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(130,71,229,0.08);
  cursor: pointer;
  transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
  letter-spacing: 0.5px;
}
button:hover, button:focus {
  background: linear-gradient(90deg, #ff8c00 0%, #8247e5 100%);
  box-shadow: 0 4px 16px rgba(130,71,229,0.15);
  transform: translateY(-2px) scale(1.03);
  outline: none;
}
button:active {
  background: linear-gradient(90deg, #8247e5 0%, #ff8c00 100%);
  transform: scale(0.98);
}
button:disabled {
  background: #e0e0e0;
  color: #aaa;
  cursor: not-allowed;
  box-shadow: none;
}
input, select {
  width: 100%;
  margin-bottom: 12px;
  padding: 12px;
  border-radius: 10px;
  border: 1.5px solid #e5e5e5;
  background: rgba(255,255,255,0.15);
  color: #222;
  font-size: 15px;
  transition: border 0.2s, box-shadow 0.2s;
}
input:focus, select:focus {
  border: 1.5px solid #8247e5;
  box-shadow: 0 0 0 2px #8247e533;
  outline: none;
}
#locks > div {
  background: rgba(255,255,255,0.12);
  border: 1.5px solid #e5e5e5;
  border-radius: 12px;
  margin-bottom: 14px;
  padding: 14px;
  color: #222;
  font-size: 15px;
  box-shadow: 0 2px 8px rgba(130,71,229,0.06);
}
#locks b {
  color: #8247e5;
}
#locks .unlock-btn {
  width: auto;
  margin: 8px 0 0 0;
  padding: 8px 18px;
  background: linear-gradient(90deg, #4caf50 0%, #8247e5 100%);
  color: #fff;
  font-weight: 600;
  border-radius: 8px;
  font-size: 15px;
  box-shadow: 0 2px 8px rgba(76,175,80,0.08);
}
#locks .unlock-btn:hover {
  background: linear-gradient(90deg, #8247e5 0%, #4caf50 100%);
}
#locks .unlocked {
  color: #4caf50;
  font-weight: 600;
}
#locks .locked {
  color: #ff8c00;
  font-weight: 600;
}
</style>
</head>
<body>

<!-- OTP Login Screen and Vault UI (unchanged, not shown for brevity) -->

<!-- CryptoLocker UI START -->
<div id="crypto-locker">
  <h2 style="text-align:center;color:#8247e5;margin-bottom:18px;">CryptoLocker</h2>
  <button id="connectWallet">Connect Wallet</button>
  <div id="walletAddress" style="margin:10px 0; color:#8247e5; font-weight:600;"></div>
  <input id="tokenAddress" placeholder="ERC20 Token Address" />
  <input id="amount" placeholder="Amount" type="number" />
  <select id="duration">
    <option value="2592000">30 days</option>
    <option value="7776000">90 days</option>
    <option value="15552000">180 days</option>
    <option value="31536000">1 year</option>
  </select>
  <button id="lockTokens">Lock Tokens</button>
  <h3 style="color:#8247e5;">Your Locks</h3>
  <div id="locks"></div>
</div>
<!-- CryptoLocker UI END -->

<script>
const client = new thirdweb.ThirdwebClient({ clientId: "10f433657d1018e7003e5cd1cb9c61d7" });
const contractAddress = "0xcc60708B6faE3b8BA4F449e6dE88Ef8E4afd3B22";
const chain = thirdweb.sepolia;

let wallet;

document.getElementById("connectWallet").onclick = async () => {
  wallet = await thirdweb.connect({
    client,
    wallets: [thirdweb.metamaskWallet()],
    chain,
  });
  document.getElementById("walletAddress").innerText = "Connected: " + wallet.getAddress();
  loadLocks();
};

document.getElementById("lockTokens").onclick = async () => {
  if (!wallet) return alert("Connect wallet first!");
  const token = document.getElementById("tokenAddress").value;
  const amount = document.getElementById("amount").value;
  const duration = document.getElementById("duration").value;
  if (!token || !amount || !duration) return alert("Fill all fields!");
  const contract = await thirdweb.getContract({ client, address: contractAddress, chain });
  try {
    await contract.call("lock", [token, amount, duration]);
    alert("Tokens locked!");
    loadLocks();
  } catch (e) {
    alert("Error: " + (e.message || e));
  }
};

async function unlockLock(lockId) {
  if (!wallet) return alert("Connect wallet first!");
  const contract = await thirdweb.getContract({ client, address: contractAddress, chain });
  try {
    await contract.call("unlock", [lockId]);
    alert("Unlocked!");
    loadLocks();
  } catch (e) {
    alert("Error: " + (e.message || e));
  }
}

async function loadLocks() {
  if (!wallet) return;
  const contract = await thirdweb.getContract({ client, address: contractAddress, chain });
  const locks = await contract.call("getLocks", [wallet.getAddress()]);
  const now = Math.floor(Date.now() / 1000);
  document.getElementById("locks").innerHTML = locks.length
    ? locks
        .map((lock, i) => {
          const unlockTime = Number(lock.start) + Number(lock.duration);
          const canUnlock = !lock.claimed && now >= unlockTime;
          return `
            <div>
              <b>#${i}</b><br>
              Token: ${lock.token}<br>
              Amount: ${lock.amount}<br>
              <b>Profit: ${lock.profit}</b><br>
              Start: ${new Date(lock.start * 1000).toLocaleString()}<br>
              Duration: ${lock.duration / (24 * 60 * 60)} days<br>
              Claimed: ${lock.claimed ? "Yes" : "No"}<br>
              ${canUnlock
                ? `<button class="unlock-btn" onclick="unlockLock(${i})">Unlock</button>`
                : lock.claimed
                  ? `<span class="unlocked">Unlocked</span>`
                  : `<span class="locked">Locked</span>`
              }
            </div>
          `;
        })
        .join("")
    : "No locks found.";
}
window.unlockLock = unlockLock;
</script>

</body>
</html>
